<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Mappings - Financecim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex" x-data="{ 
        showAddModal: false,
        showEditModal: false,
        editingMapping: null,
        searchTerm: '',
        mappings: [
            { id: 1, source_category: 'Food & Dining', category: 'Restaurants', category_color: '#10B981' },
            { id: 2, source_category: 'Groceries', category: 'Groceries', category_color: '#10B981' },
            { id: 3, source_category: 'Gas & Fuel', category: 'Gas', category_color: '#3B82F6' },
            { id: 4, source_category: 'Automotive', category: 'Transportation', category_color: '#3B82F6' },
            { id: 5, source_category: 'Travel & Entertainment', category: 'Entertainment', category_color: '#8B5CF6' },
            { id: 6, source_category: 'General Merchandise', category: 'Shopping', category_color: '#EC4899' },
            { id: 7, source_category: 'Bills & Utilities', category: 'Bills & Utilities', category_color: '#EF4444' },
            { id: 8, source_category: 'Cable/Internet/Phone', category: 'Bills & Utilities', category_color: '#EF4444' },
            { id: 9, source_category: 'Personal Care', category: 'Shopping', category_color: '#EC4899' },
            { id: 10, source_category: 'Home Improvement', category: 'Shopping', category_color: '#EC4899' },
            { id: 11, source_category: 'Transfer', category: 'Transfer', category_color: '#6B7280' },
            { id: 12, source_category: 'Payment/Credit', category: 'Payment', category_color: '#6B7280' }
        ],
        get filteredMappings() {
            if (!this.searchTerm) return this.mappings;
            return this.mappings.filter(m => 
                m.source_category.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
                m.category.toLowerCase().includes(this.searchTerm.toLowerCase())
            );
        }
    }">
        <!-- Sidebar -->
        <div class="w-64 bg-white shadow-lg">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-gray-800">Financecim</h1>
            </div>
            <nav class="mt-6">
                <a href="./sources.html" class="block px-6 py-3 text-gray-700 hover:bg-gray-50">
                    Sources
                </a>
                <a href="./categories.html" class="block px-6 py-3 text-gray-700 hover:bg-gray-50">
                    Categories
                </a>
                <a href="./mappings.html" class="block px-6 py-3 bg-blue-50 text-blue-700 border-r-4 border-blue-700">
                    Category Mappings
                </a>
                <a href="./rules.html" class="block px-6 py-3 text-gray-700 hover:bg-gray-50">
                    Auto-Categorization Rules
                </a>
                <a href="./transactions.html" class="block px-6 py-3 text-gray-700 hover:bg-gray-50">
                    Transactions
                </a>
                <a href="./import.html" class="block px-6 py-3 text-gray-700 hover:bg-gray-50">
                    Import Data
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-8">
            <div class="mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-3xl font-bold text-gray-800">Source Category Mappings</h2>
                    <button @click="showAddModal = true" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors flex items-center">
                        <i data-lucide="plus" class="w-4 h-4 mr-2"></i>
                        Add Mapping
                    </button>
                </div>
                <p class="text-gray-600">Map source categories from various banks/cards to your unified categories</p>
            </div>

            <!-- Search Bar -->
            <div class="mb-6">
                <input 
                    type="text" 
                    x-model="searchTerm"
                    placeholder="Search by source category or mapped category..."
                    class="w-full md:w-96 border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
            </div>

            <!-- Mappings Table -->
            <div class="bg-white rounded-lg shadow overflow-hidden">
                <table class="min-w-full">
                    <thead class="bg-gray-50 border-b">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source Category</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">→</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mapped To</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <template x-for="mapping in filteredMappings" :key="mapping.id">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                    <span class="bg-gray-100 px-2 py-1 rounded text-sm" x-text="mapping.source_category"></span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">→</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                    <span class="inline-flex items-center">
                                        <span class="w-3 h-3 rounded-full mr-2" :style="`background-color: ${mapping.category_color}`"></span>
                                        <span x-text="mapping.category"></span>
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button @click="editingMapping = mapping; showEditModal = true" class="text-blue-600 hover:text-blue-900 mr-3">Edit</button>
                                    <button @click="mappings = mappings.filter(m => m.id !== mapping.id)" class="text-red-600 hover:text-red-900">Delete</button>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
                <div x-show="filteredMappings.length === 0" class="text-center py-8 text-gray-500">
                    No mappings found
                </div>
            </div>
        </div>

        <!-- Add Modal -->
        <div x-show="showAddModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-96" @click.away="showAddModal = false">
                <h3 class="text-lg font-semibold mb-4">Add Category Mapping</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Source Category Name</label>
                        <input type="text" class="w-full border rounded-lg px-3 py-2" placeholder="e.g., Food & Dining, Travel & Entertainment">
                        <p class="text-xs text-gray-500 mt-1">Enter the exact category text from your bank/card statements</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Map to Category</label>
                        <select class="w-full border rounded-lg px-3 py-2">
                            <option value="">Select a category...</option>
                            <optgroup label="Food & Dining">
                                <option value="2">Groceries</option>
                                <option value="3">Restaurants</option>
                            </optgroup>
                            <optgroup label="Transportation">
                                <option value="4">Transportation (General)</option>
                                <option value="5">Gas</option>
                            </optgroup>
                            <option value="6">Entertainment</option>
                            <option value="7">Shopping</option>
                            <option value="8">Bills & Utilities</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-2 pt-4">
                        <button @click="showAddModal = false" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                        <button @click="showAddModal = false" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">Add Mapping</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Modal -->
        <div x-show="showEditModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-96" @click.away="showEditModal = false">
                <h3 class="text-lg font-semibold mb-4">Edit Category Mapping</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Source Category Name</label>
                        <input type="text" class="w-full border rounded-lg px-3 py-2" :value="editingMapping?.source_category">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Map to Category</label>
                        <select class="w-full border rounded-lg px-3 py-2">
                            <option value="">Select a category...</option>
                            <optgroup label="Food & Dining">
                                <option value="2">Groceries</option>
                                <option value="3">Restaurants</option>
                            </optgroup>
                            <optgroup label="Transportation">
                                <option value="4">Transportation (General)</option>
                                <option value="5">Gas</option>
                            </optgroup>
                            <option value="6">Entertainment</option>
                            <option value="7">Shopping</option>
                            <option value="8">Bills & Utilities</option>
                        </select>
                    </div>
                    <div class="flex justify-end space-x-2 pt-4">
                        <button @click="showEditModal = false" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                        <button @click="showEditModal = false" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">Save Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>